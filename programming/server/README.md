Here goes server source codes with same layout as client's.